- name: installing passlib for creating rutorrent user
  pip:
    name: passlib

- name: creating rutorrent user and password for nginx
  htpasswd:
    path: /etc/nginx/.htpasswd
    name: '{{ rutorrent_user }}'
    password: '{{ rutorrent_pass }}'
    group: '{{ web_group }}'
    mode: u=rw,g=r,o=

- name: cloning rutorrent repository
  git:
    repo: '{{ rutorrent_git_repo }}'
    dest: '{{ web_root }}/rutorrent'
    version: '{{ rutorrent_git_version }}'
    force: yes

- name: creating rutorrent config.php
  template:
    src: config.php.j2
    dest: '{{ web_root }}/rutorrent/conf/config.php'

- name: adding web user to torrent group
  user:
    name: '{{ web_user }}'
    group: '{{ web_group }}'
    groups:
      - '{{ web_group }}'
      - '{{ torrent_group }}'

- name: allowing access for torrent group
  file:
    path: '{{ web_root }}/  rutorrent/share'
    group: '{{ torrent_group }}'
    mode: u=rwx,g=rwx,o=rx
    state: directory
    recurse: yes

- name: reloading nginx
  service:
    name: nginx
    state: reloaded