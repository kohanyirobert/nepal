- name: updating apt cache before start
  apt:
    update_cache: yes

- name: making sure we're provisiong debian
  fail:
    msg: can provision debian only
  when: ansible_distribution != 'Debian'

- name: making sure we're provisiong stretch  
  fail:
    msg: can provision stretch only
  when: ansible_distribution_release != 'stretch'

- name: making sure we're provisiong armv7
  fail:
    msg: can provision armv7 only
  when: ansible_architecture is not match('armv7.*')

- name: creating rtorrent/www shared group
  group:
    name: '{{ rtorrent_www_shared_group }}'

- name: adding www user to rtorrent/www shared group
  user:
    name: '{{ www_user }}'
    append: yes
    groups:
      - '{{ rtorrent_www_shared_group }}'

- name: creating rtorrent user and adding to rtorrent/www and rtorrent/plex shared groups
  user:
    name: '{{ rtorrent_user }}'
    group: '{{ rtorrent_www_shared_group }}'
    groups:
      - '{{ rtorrent_www_shared_group }}'
      - '{{ rtorrent_plex_shared_group }}'

- name: creating mount point for storage device
  file:
    path: '{{ item }}'
    group: '{{ rtorrent_plex_shared_group }}'
    mode: u=rwx,g=rwx,o=
    state: directory
  with_items:
    - '{{ storage_device_mount_point }}'
    - '{{ storage_device_mount_point }}/Downloads'
    - '{{ storage_device_mount_point }}/Plex'
    - '{{ storage_device_mount_point }}/Plex/szinkronos-filmek'
    - '{{ storage_device_mount_point }}/Plex/szinkronos-sorozatok'
    - '{{ storage_device_mount_point }}/Plex/feliratos-filmek'
    - '{{ storage_device_mount_point }}/Plex/feliratos-sorozatok'

- name: mounting storage device by uuid to mount point
  mount:
    path: '{{ storage_device_mount_point }}'
    src: UUID={{ storage_device_uuid }}
    fstype: '{{ storage_device_fstype }}'
    boot: yes
    state: mounted